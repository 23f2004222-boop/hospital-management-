{% extends "base.html" %}
{% block title %}Search Results{% endblock %}

{% block content %}

<h3 class="mb-3">Search results for: "{{ q }}"</h3>

<a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm mb-3">Back to Dashboard</a>

<hr>

<h5>Doctors</h5>

{% if doctors %}
<table class="table table-sm table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Dept</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for d in doctors %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ d.username }}</td>
            <td>{{ d.email }}</td>
            <td>{{ d.department.department_name if d.department else '-' }}</td>

            <td>
                <a href="{{ url_for('admin_edit_doctor', doctor_id=d.id) }}"
                   class="btn btn-sm btn-outline-primary">edit</a>

                {% if d.blacklisted %}
                    <a href="{{ url_for('admin_unblacklist_user', user_id=d.id) }}"
                       class="btn btn-sm btn-outline-warning">un-blacklist</a>
                {% else %}
                    <a href="{{ url_for('admin_blacklist_user', user_id=d.id) }}"
                       class="btn btn-sm btn-outline-warning">blacklist</a>
                {% endif %}

                <form action="{{ url_for('admin_delete_doctor', doctor_id=d.id) }}"
                      method="POST" style="display:inline;">
                    <button class="btn btn-sm btn-outline-danger">remove</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">No doctors found</p>
{% endif %}

<hr>

<h5>Patients</h5>

{% if patients %}
<table class="table table-sm table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for p in patients %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ p.username }}</td>
            <td>{{ p.email }}</td>

            <td>
                {% if p.blacklisted %}
                    <a href="{{ url_for('admin_unblacklist_user', user_id=p.id) }}"
                       class="btn btn-sm btn-outline-warning">un-blacklist</a>
                {% else %}
                    <a href="{{ url_for('admin_blacklist_user', user_id=p.id) }}"
                       class="btn btn-sm btn-outline-warning">blacklist</a>
                {% endif %}

                <form action="{{ url_for('admin_delete_patient', patient_id=p.id) }}"
                      method="POST" style="display:inline;">
                    <button class="btn btn-sm btn-outline-danger">remove</button>
                </form>

                <a href="{{ url_for('admin_patient_history', patient_id=p.id) }}"
                   class="btn btn-sm btn-outline-info">history</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted">No patients found</p>
{% endif %}

{% endblock %}
